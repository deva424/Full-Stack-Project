<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f6f8; }
  h1 { color: #333; }
  #projects { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
  .project-card { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); width: 200px; cursor: pointer; transition: transform 0.2s; }
  .project-card:hover { transform: scale(1.05); }
  button { padding: 10px 15px; border: none; border-radius: 5px; background: #007bff; color: #fff; cursor: pointer; transition: background 0.2s; }
  button:hover { background: #0056b3; }
  #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
  #modalContent { background: #fff; padding: 20px; border-radius: 10px; width: 300px; }
  #toast { position: fixed; bottom: 20px; right: 20px; background: #333; color: #fff; padding: 10px 15px; border-radius: 5px; display: none; }
</style>
</head>
<body>

<h1>Dashboard</h1>
<button onclick="openModal()">New Project</button>

<div id="projects"></div>

<!-- Modal -->
<div id="modal">
  <div id="modalContent">
    <h3>Create Project</h3>
    <input type="text" id="projectTitle" placeholder="Project Title" style="width:100%; padding:8px; margin-bottom:10px;">
    <textarea id="projectDesc" placeholder="Description" style="width:100%; padding:8px; margin-bottom:10px;"></textarea>
    <button onclick="submitProject()">Create</button>
    <button onclick="closeModal()" style="background:#6c757d; margin-left:5px;">Cancel</button>
  </div>
</div>

<div id="toast"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const token = localStorage.getItem("token");
const socket = io({ auth: { token } });
const projectsDiv = document.getElementById("projects");
const modal = document.getElementById("modal");
const toast = document.getElementById("toast");

function showToast(message) {
  toast.textContent = message;
  toast.style.display = "block";
  setTimeout(() => toast.style.display = "none", 3000);
}

async function fetchProjects() {
  let res = await fetch("/api/projects", { headers: { Authorization: "Bearer "+token } });
  let data = await res.json();
  projectsDiv.innerHTML = data.map(p => `
    <div class="project-card">
      <b>${p.title}</b>
      <p>${p.description}</p>
    </div>
  `).join("");
}

function openModal() { modal.style.display = "flex"; }
function closeModal() { modal.style.display = "none"; }

async function submitProject() {
  const title = document.getElementById("projectTitle").value;
  const description = document.getElementById("projectDesc").value;
  if(!title) return showToast("Title cannot be empty");
  
  let res = await fetch("/api/projects", {
    method:"POST",
    headers:{"Content-Type":"application/json", Authorization:"Bearer "+token},
    body: JSON.stringify({ title, description })
  });
  await res.json();
  closeModal();
  fetchProjects();
  showToast("Project created!");
}

socket.on("taskCreated", t => showToast("New Task: " + t.title));
socket.on("notification", n => showToast("Notification: " + n.title));

fetchProjects();
</script>
</body>
</html>
